(function(){var e,t;e=function(){function e(e){var t,n;this.options={target:"instafeed",get:"popular",resolution:"thumbnail",sortBy:"most-recent",links:true,limit:15,mock:false};if(typeof e==="object"){for(t in e){n=e[t];this.options[t]=n}}this.unique=this._genKey()}e.prototype.run=function(){var t,n,r;if(typeof this.options.clientId!=="string"){if(typeof this.options.accessToken!=="string"){throw new Error("Missing clientId or accessToken.")}}if(typeof this.options.accessToken!=="string"){if(typeof this.options.clientId!=="string"){throw new Error("Missing clientId or accessToken.")}}if(this.options.before!=null&&typeof this.options.before==="function"){this.options.before.call(this)}if(typeof document!=="undefined"&&document!==null){r=document.createElement("script");r.id="instafeed-fetcher";r.src=this._buildUrl();t=document.getElementsByTagName("head");t[0].appendChild(r);n="instafeedCache"+this.unique;window[n]=new e(this.options);window[n].unique=this.unique}return true};e.prototype.parse=function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v;if(typeof e!=="object"){if(this.options.error!=null&&typeof this.options.error==="function"){this.options.error.call(this,"Invalid JSON data");return false}else{throw new Error("Invalid JSON response")}}if(e.meta.code!==200){if(this.options.error!=null&&typeof this.options.error==="function"){this.options.error.call(this,e.meta.error_message);return false}else{throw new Error("Error from Instagram: "+e.meta.error_message)}}if(e.data.length===0){if(this.options.error!=null&&typeof this.options.error==="function"){this.options.error.call(this,"No images were returned from Instagram");return false}else{throw new Error("No images were returned from Instagram")}}if(this.options.success!=null&&typeof this.options.success==="function"){this.options.success.call(this,e)}if(this.options.sortBy!=="most-recent"){if(this.options.sortBy==="random"){c=["","random"]}else{c=this.options.sortBy.split("-")}l=c[0]==="least"?true:false;switch(c[1]){case"random":e.data.sort(function(){return.5-Math.random()});break;case"recent":e.data=this._sortBy(e.data,"created_time",l);break;case"liked":e.data=this._sortBy(e.data,"likes.count",l);break;case"commented":e.data=this._sortBy(e.data,"comments.count",l);break;default:throw new Error("Invalid option for sortBy: '"+this.options.sortBy+"'.")}}if(typeof document!=="undefined"&&document!==null&&this.options.mock===false){document.getElementById(this.options.target).innerHTML="";u=e.data;if(u.length>this.options.limit){u=u.slice(0,this.options.limit+1||9e9)}if(this.options.template!=null&&typeof this.options.template==="string"){i="";o="";for(h=0,d=u.length;h<d;h++){s=u[h];o=this._makeTemplate(this.options.template,{model:s,id:s.id,link:s.link,created_time:this._timeDifference(s.created_time),image:s.images[this.options.resolution].url,caption:this._getObjectProperty(s,"caption.text"),likes:s.likes.count,comments:s.comments.count,location:this._getObjectProperty(s,"location.name")});i+=o}document.getElementById(this.options.target).innerHTML=i}else{n=document.createDocumentFragment();for(p=0,v=u.length;p<v;p++){s=u[p];a=document.createElement("img");a.src=s.images[this.options.resolution].url;if(this.options.links===true){t=document.createElement("a");t.href=s.link;t.appendChild(a);n.appendChild(t)}else{n.appendChild(a)}}document.getElementById(this.options.target).appendChild(n)}r=document.getElementsByTagName("head")[0];r.removeChild(document.getElementById("instafeed-fetcher"));f="instafeedCache"+this.unique;delete window[f]}if(this.options.after!=null&&typeof this.options.after==="function"){this.options.after.call(this)}return true};e.prototype._buildUrl=function(){var e,t,n;e="https://api.instagram.com/v1";switch(this.options.get){case"popular":t="media/popular";break;case"tagged":if(typeof this.options.tagName!=="string"){throw new Error("No tag name specified. Use the 'tagName' option.")}t="tags/"+this.options.tagName+"/media/recent";break;case"location":if(typeof this.options.locationId!=="number"){throw new Error("No location specified. Use the 'locationId' option.")}t="locations/"+this.options.locationId+"/media/recent";break;case"user":if(typeof this.options.userId!=="number"){throw new Error("No user specified. Use the 'userId' option.")}if(typeof this.options.accessToken!=="string"){throw new Error("No access token. Use the 'accessToken' option.")}t="users/"+this.options.userId+"/media/recent";break;default:throw new Error("Invalid option for get: '"+this.options.get+"'.")}n=""+e+"/"+t;if(this.options.accessToken!=null){n+="?access_token="+this.options.accessToken}else{n+="?client_id="+this.options.clientId}n+="&count="+this.options.limit;n+="&callback=instafeedCache"+this.unique+".parse";return n};e.prototype._genKey=function(){var e;e=function(){return((1+Math.random())*65536|0).toString(16).substring(1)};return""+e()+e()+e()+e()};e.prototype._makeTemplate=function(e,t){var n,r,i,s,o;r=/(?:\{{2})([\w\[\]\.]+)(?:\}{2})/;n=e;while(r.test(n)){i=n.match(r)[1];s=(o=this._getObjectProperty(t,i))!=null?o:"";n=n.replace(r,""+s)}return n};e.prototype._getObjectProperty=function(e,t){var n,r;t=t.replace(/\[(\w+)\]/g,".$1");r=t.split(".");while(r.length){n=r.shift();if(e!=null&&n in e){e=e[n]}else{return null}}return e};e.prototype._sortBy=function(e,t,n){var r;r=function(e,r){var i,s;i=this._getObjectProperty(e,t);s=this._getObjectProperty(r,t);if(n){if(i>s){return 1}else{return-1}}if(i<s){return 1}else{return-1}};e.sort(r.bind(this));return e};e.prototype._timeDifference=function(e){var t=new Date;var n=new Date(e*1e3);var r=60*1e3;var i=r*60;var s=i*24;var o=s*30;var u=s*365;var a="";var f=t-n;if(f<r){var l=Math.round(f/1e3);if(l>1)a="s";return l+" second"+a+" ago"}else if(f<i){var l=Math.round(f/r);if(l>1)a="s";return l+" minute"+a+" ago"}else if(f<s){var l=Math.round(f/i);if(l>1)a="s";return l+" hour"+a+" ago"}else if(f<o){var l=Math.round(f/s);if(l>1)a="s";return l+" day"+a+" ago"}else if(f<u){var l=Math.round(f/o);if(l>1)a="s";return l+" month"+a+" ago"}else{var l=Math.round(f/u);if(l>1)a="s";return l+" year"+a+" ago"}};return e}();t=typeof exports!=="undefined"&&exports!==null?exports:window;t.Instafeed=e}).call(this)